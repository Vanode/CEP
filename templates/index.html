<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VSLI</title>
  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      background: linear-gradient(135deg,#1e2a38,#3a5068);
      color: #f4f7fb;
      font-family: 'Inter','Poppins',Arial,sans-serif;
      min-height:100vh; display:flex; flex-direction:column; align-items:center;
    }
    header {
      width:100vw; max-width:1100px;
      background: rgba(58,80,104,0.9); color:#f4f7fb; text-align:center;
      padding:28px 0 18px; border-radius:0 0 28px 28px;
      box-shadow:0 8px 32px rgba(69,123,255,0.22);
    }
    header img { height:110px; display:block; margin:0 auto 6px auto; }
    nav {
      width:100%; max-width:1100px; margin:18px 0 0;
      background: rgba(58,80,104,0.85); border-radius:28px;
      display:flex; justify-content:center; gap:.7rem; padding:6px;
    }
    nav button {
      flex:1 1 160px; background:none; border:none; color:#f4f7fb;
      padding:12px 0; font-weight:700; text-transform:uppercase;
      border-radius:20px; cursor:pointer; position:relative;
    }
    /* subtle accent instead of big yellow bar */
    nav button.active, nav button:hover {
      background: linear-gradient(90deg,#5fa0ff,#4a8fe8);
      color:#08223f;
      box-shadow:0 6px 22px rgba(74,143,232,0.2);
    }
    main {
      width:100%; max-width:900px; margin:28px 0 48px;
      background: rgba(25,41,57,0.75); border-radius:24px; padding:28px;
      box-shadow:0 14px 48px rgba(69,123,255,0.2);
    }
    section { display:none; width:100%; }
    section.active { display:block; }
    h1 { color:#76a9fa; font-weight:900; margin-bottom:12px; text-align:center; }
    video {
      display:block; margin:0 auto 20px auto;
      border-radius:14px; width:97%; max-width:700px; max-height:420px;
      object-fit:cover; border:4px solid #76e8f7; background:#181e39;
      box-shadow:0 8px 28px rgba(0,136,246,0.18);
    }
    .translation-box {
      width:90px; height:90px; margin:0 auto 22px auto;
      border-radius:12px; border:3px solid #76a9fa; background:#102034;
      color:#76a9fa; display:flex; align-items:center; justify-content:center;
      font-size:2.4rem; font-weight:800; box-shadow:0 6px 20px rgba(118,169,250,0.12);
    }
    .simulate-btn {
      display:block; margin:14px auto; padding:10px 28px; border-radius:28px;
      border:none; background:linear-gradient(90deg,#76a9fa,#4169e8); color:#fff;
      font-weight:700; cursor:pointer;
    }
    /* hidden canvas */
    #captureCanvas { display:none; }
    @media (max-width:640px) { header img {height:90px;} }
  </style>
</head>
<body>
  <header>
    <!-- Use Flask's url_for to reference static image -->
    <img src="{{ url_for('static', filename='HASTAKSHAR.png') }}" alt="Logo" style = "height:200px; margin-bottom:18px">
    <h1>Virtual Sign Language Interpreter</h1>
  </header>

  <nav>
    <button id="tabHome" class="active">Home</button>
    <button id="tabInterpreter">Interpreter</button>
    <button id="tabAbout">About</button>
  </nav>

  <main>
    <section id="homeSection" class="active">
      <h1>Welcome</h1>
      <p style="text-align:center;">Click <strong>Interpreter</strong> to start realtime Indian Sign Language detection.</p>
      <br>
         <ul>
              <li>Real-time Sign Language gesture capture using your webcam</li>
              <li>Minimal, modern, and distraction-free interface</li>
              <li>Optimized for mobile, tablet, and desktop</li>
              <li>Perfect for learners, educators, and everyone in-between</li>
         </ul>
    </section>

    <section id="interpreterSection">
      <h1>Interpreter</h1>
      <video id="video" autoplay playsinline muted></video>
      <canvas id="captureCanvas"></canvas> <!-- required for capture -->
      <div class="translation-box" id="singleLetterBox"></div>
      <button class="simulate-btn" id="simulateBtn">Simulate Translation</button>
      <p style="text-align:center;color:#c4d4fc;margin-top:12px;">Show a finger/letter sign to your camera â€” the corresponding letter will appear above.</p>
    </section>

    <section id="aboutSection">
      <h1>About the project</h1>
      <p>This website offers an interactive, web-based approach for American Sign Language communication and learning. Created using cutting-edge HTML, CSS, and JavaScript, it puts accessibility first and brings sign language technology to everyone.</p>
      <ul>
        <li><strong>Purpose:</strong> Promote inclusivity and everyday communication</li>
        <li><strong>Features:</strong> Smooth UI, webcam-enabled sign interpreter, instant feedback</li>
        <li><strong>Upcoming:</strong> Real machine learning translation, extended sign support</li>
      </ul>
      <p><strong>We welcome suggestions, feedback, and collaborations!</strong></p>
      <br>
      <p>Made by: </p>
      <p>2nd year Electronics & Computer Engineering Students from PICT</p>
      <ul>
        <li>25128 - Shivam Khamkar</li>
        <li>25163 - Soham Sawant</li>
        <li>25171 - Sujal Supekar</li>
        <li>25173 - Vajra Thatte</li>
        <li>25174 - Varad Tonpe</li>
        <li>25176 - Gandhar Deshmukh</li>
      </ul>
    </section>
  </main>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    // Tab logic
    const tabs = { tabHome: "homeSection", tabInterpreter: "interpreterSection", tabAbout: "aboutSection" };
    for (let id in tabs) {
      document.getElementById(id).addEventListener("click", () => {
        for (let btn in tabs) {
          document.getElementById(btn).classList.remove("active");
          document.getElementById(tabs[btn]).classList.remove("active");
        }
        document.getElementById(id).classList.add("active");
        document.getElementById(tabs[id]).classList.add("active");
        if (id === "tabInterpreter") startWebcam();
        else stopWebcam();
      });
    }

    const video = document.getElementById("video");
    const canvas = document.getElementById("captureCanvas");
    const singleLetterBox = document.getElementById("singleLetterBox");
    let stream = null, captureInterval = null;

    const socket = io();

    socket.on("prediction", (data) => {
      singleLetterBox.textContent = data.letter || "";
    });

    async function startWebcam() {
      if (stream) return;
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: { width:640, height:480 }, audio:false });
        video.srcObject = stream;
        video.onloadedmetadata = () => {
          // set canvas size to video
          canvas.width = video.videoWidth || 640;
          canvas.height = video.videoHeight || 480;
          startSendingFrames(120);
        };
      } catch (err) {
        console.error('getUserMedia error', err);
        alert("Camera access denied or unavailable. Check site permissions and try again.");
      }
    }

    function stopWebcam() {
      if (captureInterval) { clearInterval(captureInterval); captureInterval = null; }
      if (stream) {
        stream.getTracks().forEach(t => t.stop());
        stream = null;
        video.srcObject = null;
      }
    }

    function startSendingFrames(intervalMs = 120) {
      if (captureInterval) return;
      const ctx = canvas.getContext("2d");
      captureInterval = setInterval(() => {
        try {
          // mirror the capture to match server flip
          ctx.save();
          ctx.scale(-1, 1);
          ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
          ctx.restore();

          const dataURL = canvas.toDataURL('image/jpeg', 0.7);
          const base64 = dataURL.split(',')[1];
          socket.emit('frame', { image: base64 });
        } catch (e) {
          console.warn('frame send error', e);
        }
      }, intervalMs);
    }

    // simulate button
    document.getElementById("simulateBtn").addEventListener("click", () => {
      const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      singleLetterBox.textContent = letters[Math.floor(Math.random() * letters.length)];
    });

    // make sure to stop webcam on page close
    window.addEventListener('beforeunload', stopWebcam);
  </script>
</body>
</html>
